<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="welcome-section">
      <h1>Mis Citas Médicas</h1>
      <p>Gestiona y revisa tu historial de citas</p>
    </div>
    <div class="user-info">
      <button 
        pButton 
        icon="pi pi-arrow-left" 
        label="Volver al Dashboard" 
        class="p-button-outlined p-button-secondary"
        (click)="volverAlDashboard()">
      </button>
    </div>
  </div>

  <!-- Tarjeta de Resumen -->
  <div class="summary-cards">
    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-calendar summary-icon"></i>
        <div class="summary-text">
          <h3>{{ citas.length }}</h3>
          <p>Citas Totales</p>
        </div>
      </div>
    </p-card>

    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-clock summary-icon pending"></i>
        <div class="summary-text">
          <h3>{{ citasPendientes }}</h3>
          <p>Pendientes</p>
        </div>
      </div>
    </p-card>

    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-check-circle summary-icon accepted"></i>
        <div class="summary-text">
          <h3>{{ citasAceptadas }}</h3>
          <p>Aceptadas</p>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Tabla de Citas -->
  <p-card header="Historial de Citas" class="citas-table-card">

    <p-table 
      [value]="citas" 
      [paginator]="true" 
      [rows]="5"
      [rowsPerPageOptions]="[5, 10, 20]"
      [loading]="loading"
      styleClass="p-datatable-striped">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Médico</th>
          <th>Especialidad</th>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Motivo</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-cita>
        <tr>
          <td>
            <strong>{{ cita.medicoNombre }}</strong>
            <br>
            <small class="text-muted">Tarjeta: {{ cita.medicoNumeroTarjetaProfesional }}</small>
          </td>
          <td>{{ cita.medicoEspecialidad }}</td>
          <td>{{ formatearFecha(cita.fechaCita) }}</td>
          <td>{{ cita.horaCita }}</td>
          <td>
            <span pTooltip="{{ cita.motivoConsulta }}" tooltipPosition="top" class="motivo-consulta">
              {{ cita.motivoConsulta.length > 50 ? cita.motivoConsulta.substring(0, 50) + '...' : cita.motivoConsulta }}
            </span>
          </td>
          <td>
            <p-tag 
              [value]="cita.estado" 
              [severity]="getSeverity(cita.estado)"
              styleClass="estado-tag">
            </p-tag>
          </td>
          <td>
            <div class="acciones-container">
              <button 
                *ngIf="puedeCancelar(cita.estado)"
                pButton 
                icon="pi pi-times" 
                class="p-button-danger p-button-sm"
                (click)="cancelarCita(cita)"
                pTooltip="Cancelar cita" 
                tooltipPosition="top">
              </button>
              <span 
                *ngIf="!puedeCancelar(cita.estado)"
                class="no-action-text">
                No disponible
              </span>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <!-- <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center no-citas">
            <i class="pi pi-inbox" style="font-size: 3rem; color: #6c757d; margin-bottom: 1rem;"></i>
            <h3>No tienes citas agendadas</h3>
            <p>¡Programa tu primera cita médica!</p>
            <button 
              pButton 
              icon="pi pi-calendar-plus" 
              label="Agendar Primera Cita" 
              class="p-button-success"
              (click)="agendarNuevaCita()">
            </button>
          </td>
        </tr>
      </ng-template> -->
      
      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="7" class="text-center">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
            <p>Cargando tus citas...</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Components de PrimeNG -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>