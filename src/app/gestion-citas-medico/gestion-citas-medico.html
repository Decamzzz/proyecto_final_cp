<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="welcome-section">
      <h1>Gestión de Citas Médicas</h1>
      <p>Citas asignadas a {{ getNombreCompleto() }}</p>
    </div>
    <div class="user-info">
      <button 
        pButton 
        icon="pi pi-arrow-left" 
        label="Volver al Dashboard" 
        class="p-button-outlined p-button-secondary"
        (click)="volverAlDashboard()">
      </button>
    </div>
  </div>

  <!-- Tarjetas de Resumen -->
  <div class="summary-cards">
    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-calendar summary-icon"></i>
        <div class="summary-text">
          <h3>{{ citasTotales }}</h3>
          <p>Citas Totales</p>
        </div>
      </div>
    </p-card>

    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-clock summary-icon pending"></i>
        <div class="summary-text">
          <h3>{{ citasPendientes }}</h3>
          <p>Pendientes de Revisión</p>
        </div>
      </div>
    </p-card>

    <p-card class="summary-card">
      <div class="summary-content">
        <i class="pi pi-check-circle summary-icon accepted"></i>
        <div class="summary-text">
          <h3>{{ citasAceptadas }}</h3>
          <p>Citas Aceptadas</p>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Tabla de Citas -->
  <p-card header="Citas Asignadas" class="citas-table-card">

    <p-table 
      [value]="citas" 
      [paginator]="true" 
      [rows]="5"
      [rowsPerPageOptions]="[5, 10, 20]"
      [loading]="loading"
      styleClass="p-datatable-striped"
      [globalFilterFields]="['pacienteNombre', 'motivoConsulta', 'estado']">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Paciente</th>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Motivo de Consulta</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-cita>
        <tr>
          <td>
            <strong>{{ cita.pacienteNombre }}</strong>
          </td>

          <td>{{ formatearFecha(cita.fechaCita) }}</td>
          <td>{{ cita.horaCita }}</td>
          <td>
            <span class="motivo-consulta" [pTooltip]="cita.motivoConsulta" tooltipPosition="top">
              {{ cita.motivoConsulta.length > 50 ? cita.motivoConsulta.substring(0, 50) + '...' : cita.motivoConsulta }}
            </span>
          </td>
          <td>
            <p-tag 
              [value]="cita.estado" 
              [severity]="getSeverity(cita.estado)"
              styleClass="estado-tag">
            </p-tag>
          </td>
          <td>
            <div class="acciones-container">
              <div *ngIf="puedeGestionar(cita.estado)" class="botones-gestion">
                <button 
                  pButton 
                  icon="pi pi-check" 
                  class="p-button-success p-button-sm"
                  (click)="aceptarCita(cita)"
                  pTooltip="Aceptar cita" 
                  tooltipPosition="top">
                </button>
                <button 
                  pButton 
                  icon="pi pi-times" 
                  class="p-button-danger p-button-sm"
                  (click)="rechazarCita(cita)"
                  pTooltip="Rechazar cita" 
                  tooltipPosition="top">
                </button>
              </div>
              <span 
                *ngIf="!puedeGestionar(cita.estado)"
                class="no-action-text">
                {{ cita.estado === 'Aceptada' ? 'Cita confirmada' : 'No disponible' }}
              </span>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center no-citas">
            <i class="pi pi-inbox" style="font-size: 3rem; color: #6c757d; margin-bottom: 1rem;"></i>
            <h3>No tienes citas asignadas</h3>
            <p>Los pacientes podrán agendar citas contigo usando tu número de tarjeta profesional.</p>
            <small class="text-muted">Tarjeta profesional: {{ usuarioActual?.numeroTarjetaProfesional }}</small>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="7" class="text-center">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
            <p>Cargando tus citas...</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Components de PrimeNG -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
